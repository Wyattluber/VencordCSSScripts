/* ── Sorin Compact Userbar • Fix v2 (keine Überdeckung, weniger Höhe) ── */

:root{
  --sorin-userbar-height: 40px;         /* niedriger = weniger „fett“ */
  --sorin-userbar-compact-w: 88px;      /* nur Avatar + 2 Buttons + Zahnrad */
  --sorin-userbar-dur: .22s;
  --sorin-userbar-ease: ease-in-out;
  --sorin-userbar-idle-bg: color-mix(in oklab, black 82%, white 18% / 5%);
  --sorin-userbar-hover-bg: color-mix(in oklab, black 72%, white 28% / 10%);
}

/* Panels: im Fluss bleiben, nicht über Serverleiste, nichts fixed */
[class*="panels_"]{
  position: relative;
  z-index: 1;                 /* Serverleiste liegt darüber */
  padding: 4px;
  overflow: hidden;
}

/* äußere Karte: Breite bleibt kompakt; Höhe fix; kein Overlay */
[class*="panels_"] > div:has([class*="avatar"], [class*="avatarWrapper"]),
[class*="panels_"] > [class*="container"]:has([class*="voice"]),
[class*="panels_"] > [class*="container"]:has([class*="nameTag"]) {
  position: relative;
  height: var(--sorin-userbar-height);
  min-height: var(--sorin-userbar-height);
  max-height: var(--sorin-userbar-height);
  width: var(--sorin-userbar-compact-w);
  border-radius: 10px;
  background: var(--sorin-userbar-idle-bg);
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 6px;
  overflow: hidden;           /* verhindert Ausbluten */
  transition: background-color var(--sorin-userbar-dur) var(--sorin-userbar-ease);
}

/* Innerer Expander: wächst bei Hover in die Breite, äußere Karte bleibt kompakt */
[class*="panels_"] > div .sorin-expander{
  display: flex;
  align-items: center;
  gap: 8px;
  max-width: 0;               /* idle: zusammengefaltet */
  opacity: 0;
  overflow: hidden;
  transition:
    max-width var(--sorin-userbar-dur) var(--sorin-userbar-ease),
    opacity   calc(var(--sorin-userbar-dur)*.85) var(--sorin-userbar-ease);
}

/* Falls der Expander noch nicht existiert, alles „Expander-taugliche“ markieren */
[class*="panels_"] [class*="nameTag"],
[class*="panels_"] [class*="usernameContainer"],
[class*="panels_"] [class*="subtext"],
[class*="panels_"] [class*="connection"] [class*="channel"],
[class*="panels_"] [class*="connection"] [class*="actionButtons"]{
  /* diese Elemente gelten als Expander-Inhalt */
  contain: layout;
}
[class*="panels_"] > div:hover{ background: var(--sorin-userbar-hover-bg); }

/* Beim Hover: nur der Expander klappt voll in der vorhandenen Spaltenbreite auf */
[class*="panels_"] > div:hover .sorin-expander,
[class*="panels_"] > [class*="container"]:hover .sorin-expander{
  max-width: 1000px;          /* groß genug */
  opacity: 1;
}

/* Avatar + Kernbuttons immer sichtbar */
[class*="panels_"] [class*="avatar"], [class*="panels_"] [class*="avatarWrapper"]{
  width: 32px; height: 32px; border-radius: 50%; flex: 0 0 auto;
}
[class*="panels_"] [class*="button"],
[class*="panels_"] [class*="actions"] > *{ flex: 0 0 auto; }

/* VC-Zustand: bleibt idle kompakt, Details erst im Expander */
[class*="panels_"] > [class*="container"]:has([class*="connection"]){
  width: var(--sorin-userbar-compact-w);
}

/* Überdeckungen vorbeugen: Serverleiste über den Panels rendern */
[class*="guilds_"]{ z-index: 2; }
